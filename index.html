<!DOCTYPE html>
<html>
  <head>
    <title>Drive Mad - Meerkatology</title>
    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #000000;
        color: #e0e0e0;
      }

      .header {
        background-color: #111111;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 3px solid #007bff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
      }

      .header-logo {
        text-decoration: none;
        font-size: 36px;
        font-weight: bold;
        transition: color 0.3s;
      }

      .header-logo span:nth-child(1) {
        color: #ffffff;
      }

      .header-logo span:nth-child(2) {
        color: #007bff;
      }

      .header-logo:hover span:nth-child(1) {
        color: #bbbbbb;
      }

      .nav-links {
        display: flex;
        gap: 30px;
      }

      .nav-links a {
        color: #e0e0e0;
        text-decoration: none;
        font-size: 18px;
        font-weight: bold;
        transition: color 0.3s;
      }

      .nav-links a:hover {
        color: #007bff;
      }

      .content {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px;
      }

      .ad {
        width: 120px;
        height: 300px;
        background-color: #1a1a1a;
        margin: 0 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
      }

      .game-container {
        flex-shrink: 0;
        width: 85%;
        height: 700px;
        margin: 20px auto;
        background-color: #111111;
        position: relative;
        overflow: hidden;
        border-radius: 20px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.9);
      }

      .game-container iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
        border-radius: 20px;
      }

      .game-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #111111;
        border-radius: 10px;
        padding: 20px;
        margin: 30px auto;
        width: 85%;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 1);
      }

      .fullscreen-button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s;
        font-weight: bold;
      }

      .fullscreen-button:hover {
        background-color: #0056b3;
      }

      .cards-section {
        background-color: #111111;
        padding: 50px;
        text-align: center;
        border-radius: 20px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 1);
        margin: 40px;
      }

      .card-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 30px;
      }

      .card {
        display: block;
        width: 200px;
        text-align: center;
        background-color: #1a1a1a;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 1);
        overflow: hidden;
        text-decoration: none;
        color: #e0e0e0;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 1);
      }

      .card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
      }

      .card figcaption {
        padding: 15px;
        font-size: 16px;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <a href="../../index.html" class="header-logo">
        <span>Meerkat</span>
        <span>ology</span>
      </a>
    </div>

    <div class="content">
      <div class="ad ad-left">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1609993827735056" crossorigin="anonymous"></script>
        <ins class="adsbygoogle" style="display: inline-block; width: 120px; height: 300px" data-ad-client="ca-pub-1609993827735056" data-ad-slot="3552085788"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
      <div class="game-container" id="gameContainer">
        <!-- Game Embed Will Go Here -->
      </div>
      <div class="ad ad-right">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1609993827735056" crossorigin="anonymous"></script>
        <ins class="adsbygoogle" style="display: inline-block; width: 120px; height: 300px" data-ad-client="ca-pub-1609993827735056" data-ad-slot="3552085788"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </div>

    <div class="game-bar">
      <span id="gameTitle">Game Title</span>
      <span id="favoriteIcon" class="favorite-icon" style="cursor: pointer; font-size: 24px">&#9734;</span>
      <button id="fullscreenButton" class="fullscreen-button">Fullscreen</button>
    </div>

    <div class="cards-section">
      <h2>Recommended Games</h2>
      <div class="card-container" id="cardContainer">
        <!-- Cards will be loaded here -->
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var fullscreenButton = document.getElementById("fullscreenButton");
        var gameContainer = document.getElementById("gameContainer");
        var gameTitle = document.getElementById("gameTitle");

        function embedGame(gamePath, title) {
          var iframe = document.createElement("iframe");
          iframe.src = gamePath;
          gameContainer.innerHTML = "";
          gameContainer.appendChild(iframe);
          gameTitle.textContent = title;
        }

        embedGame("./game/index.html", "Drive Mad");

        fullscreenButton.addEventListener("click", function () {
          if (gameContainer.requestFullscreen) {
            gameContainer.requestFullscreen();
          } else if (gameContainer.webkitRequestFullscreen) {
            gameContainer.webkitRequestFullscreen();
          } else if (gameContainer.msRequestFullscreen) {
            gameContainer.msRequestFullscreen();
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const favoriteIcon = document.getElementById("favoriteIcon");
        const gameTitle = document.getElementById("gameTitle").textContent;

        function toggleFavorite() {
          let favorites = JSON.parse(localStorage.getItem("favorites") || "{}");
          const imagePath = "./img/" + gameTitle + ".jpg";

          if (favorites[gameTitle]) {
            delete favorites[gameTitle];
          } else {
            favorites[gameTitle] = {
              path: `./html/${gameTitle}/index.html`,
              image: imagePath,
            };
          }

          localStorage.setItem("favorites", JSON.stringify(favorites));
          updateFavoriteIcon(favorites, gameTitle);
        }

        function updateFavoriteIcon(favorites, title) {
          if (favorites[title]) {
            favoriteIcon.innerHTML = "&#9733;";
          } else {
            favoriteIcon.innerHTML = "&#9734;";
          }
        }

        const favorites = JSON.parse(localStorage.getItem("favorites") || "{}");
        updateFavoriteIcon(favorites, gameTitle);

        favoriteIcon.addEventListener("click", function () {
          toggleFavorite();
        });
      });
    </script>

    <script>
      window.onload = function () {
        var titleElement = document.getElementById("gameTitle");
        var title = titleElement.textContent;

        fetch(
          "https://script.google.com/macros/s/AKfycbx1xYwL2QqkOQHyeCWIVSMVLP_XXts5zpb0M-vbvlRl1MpRYYcv4NI-i8OaGc0YP0wpsg/exec?title=" +
            encodeURIComponent(title),
          { method: "GET" }
        )
          .then((response) => response.text())
          .then((result) => console.log(result))
          .catch((error) => console.error("Error:", error));
      };
    </script>
    <script type="module">
      import games from "../../cards-data.js";
      import { siteMapping } from "../../site-mapping.js";

      document.addEventListener("DOMContentLoaded", function () {
        const cardContainer = document.getElementById("cardContainer");

        function adjustHrefPath(path, page) {
          path = path.replace(/^\.\//, "").replace(/^\//, "");

          if (page == 2) {
            const currentHost = window.location.hostname;
            const secondPageLink = siteMapping[currentHost];
            if (secondPageLink) {
              const adjustedSecondPageLink = secondPageLink.replace(/\/$/, "");
              const adjustedPath = "/" + path;
              return adjustedSecondPageLink + adjustedPath;
            } else {
              console.error(`Current host "${currentHost}" not found in siteMapping.`);
              return "#";
            }
          } else {
            return "../../" + path;
          }
        }

        function adjustImgPath(path, page) {
          path = path.replace(/^\.\//, "").replace(/^\//, "").replace(/^img\//, "");

          if (page == 2) {
            const currentHost = window.location.hostname;
            const secondPageLink = siteMapping[currentHost];
            if (secondPageLink) {
              const adjustedSecondPageLink = secondPageLink.replace(/\/$/, "");
              const adjustedPath = "/img/" + path;
              return adjustedSecondPageLink + adjustedPath;
            } else {
              console.error(`Current host "${currentHost}" not found in siteMapping.`);
              return "../../img/" + path;
            }
          } else {
            return "../../img/" + path;
          }
        }

        function getCardHTML(gameObject) {
          const { href, imgSrc, name, page } = gameObject;

          const adjustedHref = adjustHrefPath(href, page);
          const adjustedImgSrc = adjustImgPath(imgSrc, page);

          const card = document.createElement("a");
          card.className = "card";
          card.href = adjustedHref;

          const img = document.createElement("img");
          img.src = adjustedImgSrc;
          img.alt = name;
          card.appendChild(img);

          const figcaption = document.createElement("figcaption");
          figcaption.textContent = name;
          card.appendChild(figcaption);

          return card;
        }

        const randomGames = games.sort(() => 0.5 - Math.random()).slice(0, 10);
        randomGames.forEach((game) => {
          const card = getCardHTML(game);
          cardContainer.appendChild(card);
        });
      });
    </script>
  </body>
</html>